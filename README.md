Table of Contents
=================

* [Processing Instructions](#processing-instructions)
  * [Install](#install)
  * [Grammar](#grammar)
    * [@include](#include)
    * [@exec](#exec)
    * [@source](#source)
  * [API](#api)
    * [pi](#pi)
      * [Options](#options)
    * [exec](#exec)
    * [include](#include)
    * [source](#source)
  * [License](#license)

Processing Instructions
=======================

[<img src="https://travis-ci.org/mkdoc/mkpi.svg?v=3" alt="Build Status">](https://travis-ci.org/mkdoc/mkpi)
[<img src="http://img.shields.io/npm/v/mkpi.svg?v=3" alt="npm version">](https://npmjs.org/package/mkpi)
[<img src="https://coveralls.io/repos/mkdoc/mkpi/badge.svg?branch=master&service=github&v=3" alt="Coverage Status">](https://coveralls.io/github/mkdoc/mkpi?branch=master).

Parses processing instructions in an input AST document and executes the instructions according to a grammar file.

## Install

```
npm i mkpi --save
```

For the command line interface install [mkdoc](https://github.com/mkdoc/mkdoc) globally (`npm i -g mkdoc`).

## Grammar

The default processing instruction grammar includes functions for including markdown documents, executing commands and wrapping results in fenced code blocks.

### @include

Include one or more markdown documents into the AST stream:

```html
<? @include intro.md install.md license.md ?>
```

Processing instructions in included files are also executed, paths are resolved relative to the owner document when a file is available.

### @exec

Execute a command and parse the result into the AST stream:

```html
<? @exec pwd ?>
```

To capture the stderr stream:

```html
<? @exec {err} pwd ?>
```

### @source

Load a file and wrap it in a fenced code block, the tag `type` is the info string:

```html
<? @source {javascript} index.js ?>
```

## API

### pi

```javascript
pi([opts][, cb])
```

Execute processing instructions found in the AST.

Returns an output stream.

* `opts` Object processing options.
* `cb` Function callback function.

#### Options

* `input` Readable=process.stdin input stream.
* `output` Writable=process.stdout output stream.

### exec

```javascript
exec(tag, state, cb)
```

Run an external command.

```html
<? @exec pwd ?>
```

To capture the stderr stream set the type to `err`:

```html
<? @exec {err} pwd ?>
```

By default an error is reported if the command fails, to include the
output when a command returns a non-zero exit code use the `@fails` tag:

<?

* `tag` Object parsed tag data.
* `state` Object processing instruction state.
* `cb` Function callback function.

### include

```javascript
include(tag, state, cb)
```

Include one or more markdown files into the AST, processing instructions
in included files are executed.

```html
<? @include intro.md install.md ?>
```

Include files are resolved relative to the including file when file
data is available (`mkcat file.md`), but when no file data is available,
for example from stdin (`cat file.md | mkcat`), then files are resolved
relative to the current working directory.

* `tag` Object parsed tag data.
* `state` Object processing instruction state.
* `cb` Function callback function.

### source

```javascript
source(tag, state, cb)
```

Load a file and wrap it in a fenced code block.

```html
<? @source {javascript} index.js ?>
```

* `tag` Object parsed tag data.
* `state` Object processing instruction state.
* `cb` Function callback function.

## License

MIT.

Generated by [mdp(1)](https://github.com/tmpfs/mdp).

[mkdoc]: https://github.com/mkdoc/mkdoc
[node]: http://nodejs.org
[npm]: http://www.npmjs.org
[commonmark]: http://commonmark.org
[jshint]: http://jshint.com
[jscs]: http://jscs.info
